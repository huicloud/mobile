//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./android/src/main/java/com/dzhyun/sdk/Pb2Json.java
//

#include "IOSClass.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "com/dzhyun/proto/AutoMsg.h"
#include "com/dzhyun/proto/Dzhpbtable.h"
#include "com/dzhyun/proto/Dzhua.h"
#include "com/dzhyun/sdk/Pb2Json.h"
#include "com/dzhyun/sdk/YFloat.h"
#include "com/google/protobuf/ByteString.h"
#include "com/google/protobuf/Descriptors.h"
#include "com/google/protobuf/InvalidProtocolBufferException.h"
#include "com/google/protobuf/Message.h"
#include "java/lang/Math.h"
#include "java/util/List.h"
#include "java/util/Map.h"
#include "java/util/Set.h"
#include "org/json/JSONArray.h"
#include "org/json/JSONException.h"
#include "org/json/JSONObject.h"

@interface ComDzhyunSdkPb2Json ()

+ (OrgJsonJSONArray *)parseMsgWithComDzhyunProtoAutoMsg_MSG:(ComDzhyunProtoAutoMsg_MSG *)msg;

+ (OrgJsonJSONObject *)parsePbMessageWithComGoogleProtobufMessage:(id<ComGoogleProtobufMessage>)msg;

+ (OrgJsonJSONArray *)parseTableWithComDzhyunProtoDzhpbtable_Table:(ComDzhyunProtoDzhpbtable_Table *)table;

@end

static NSString *ComDzhyunSdkPb2Json_ERROR_JSON_ = @"{}";
J2OBJC_STATIC_FIELD_GETTER(ComDzhyunSdkPb2Json, ERROR_JSON_, NSString *)
J2OBJC_STATIC_FIELD_SETTER(ComDzhyunSdkPb2Json, ERROR_JSON_, NSString *)

__attribute__((unused)) static OrgJsonJSONArray *ComDzhyunSdkPb2Json_parseMsgWithComDzhyunProtoAutoMsg_MSG_(ComDzhyunProtoAutoMsg_MSG *msg);

__attribute__((unused)) static OrgJsonJSONObject *ComDzhyunSdkPb2Json_parsePbMessageWithComGoogleProtobufMessage_(id<ComGoogleProtobufMessage> msg);

__attribute__((unused)) static OrgJsonJSONArray *ComDzhyunSdkPb2Json_parseTableWithComDzhyunProtoDzhpbtable_Table_(ComDzhyunProtoDzhpbtable_Table *table);

@implementation ComDzhyunSdkPb2Json

+ (NSString *)toJsonWithByteArray:(IOSByteArray *)pb {
  return ComDzhyunSdkPb2Json_toJsonWithByteArray_(pb);
}

+ (OrgJsonJSONArray *)parseMsgWithComDzhyunProtoAutoMsg_MSG:(ComDzhyunProtoAutoMsg_MSG *)msg {
  return ComDzhyunSdkPb2Json_parseMsgWithComDzhyunProtoAutoMsg_MSG_(msg);
}

+ (OrgJsonJSONObject *)parsePbMessageWithComGoogleProtobufMessage:(id<ComGoogleProtobufMessage>)msg {
  return ComDzhyunSdkPb2Json_parsePbMessageWithComGoogleProtobufMessage_(msg);
}

+ (OrgJsonJSONArray *)parseTableWithComDzhyunProtoDzhpbtable_Table:(ComDzhyunProtoDzhpbtable_Table *)table {
  return ComDzhyunSdkPb2Json_parseTableWithComDzhyunProtoDzhpbtable_Table_(table);
}

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  ComDzhyunSdkPb2Json_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "toJsonWithByteArray:", "toJson", "Ljava.lang.String;", 0x9, NULL, NULL },
    { "parseMsgWithComDzhyunProtoAutoMsg_MSG:", "parseMsg", "Lorg.json.JSONArray;", 0xa, NULL, NULL },
    { "parsePbMessageWithComGoogleProtobufMessage:", "parsePbMessage", "Lorg.json.JSONObject;", 0xa, NULL, NULL },
    { "parseTableWithComDzhyunProtoDzhpbtable_Table:", "parseTable", "Lorg.json.JSONArray;", 0xa, NULL, NULL },
    { "init", NULL, NULL, 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "ERROR_JSON_", NULL, 0xa, "Ljava.lang.String;", &ComDzhyunSdkPb2Json_ERROR_JSON_, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _ComDzhyunSdkPb2Json = { 2, "Pb2Json", "com.dzhyun.sdk", NULL, 0x11, 5, methods, 1, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_ComDzhyunSdkPb2Json;
}

@end

NSString *ComDzhyunSdkPb2Json_toJsonWithByteArray_(IOSByteArray *pb) {
  ComDzhyunSdkPb2Json_initialize();
  @try {
    ComDzhyunProtoDzhua_UAResponse *ua = ComDzhyunProtoDzhua_UAResponse_parseFromWithByteArray_(pb);
    if ([((ComDzhyunProtoDzhua_UAResponse *) nil_chk(ua)) getErr] != 0) {
      return ComDzhyunSdkPb2Json_ERROR_JSON_;
    }
    OrgJsonJSONObject *obj = [new_OrgJsonJSONObject_init() autorelease];
    [obj putWithNSString:@"Qid" withId:[ua getQid]];
    ComDzhyunProtoAutoMsg_MSG *msg = ComDzhyunProtoAutoMsg_MSG_parseFromWithByteArray_([((ComGoogleProtobufByteString *) nil_chk([ua getData])) toByteArray]);
    if ([((ComDzhyunProtoAutoMsg_MSG *) nil_chk(msg)) getId] != ComDzhyunProtoAutoMsg_MSG_TBL_FIELD_NUMBER) {
      [obj putWithNSString:@"Data" withId:ComDzhyunSdkPb2Json_parseMsgWithComDzhyunProtoAutoMsg_MSG_(msg)];
    }
    else {
      [obj putWithNSString:@"Data" withId:ComDzhyunSdkPb2Json_parseTableWithComDzhyunProtoDzhpbtable_Table_([((ComDzhyunProtoDzhpbtable_CData *) nil_chk([((ComDzhyunProtoDzhpbtable_Table *) nil_chk([msg getTbl])) getDataWithInt:0])) getTValuesWithInt:0])];
    }
    return [obj description];
  }
  @catch (ComGoogleProtobufInvalidProtocolBufferException *e) {
    [((ComGoogleProtobufInvalidProtocolBufferException *) nil_chk(e)) printStackTrace];
    return ComDzhyunSdkPb2Json_ERROR_JSON_;
  }
  @catch (OrgJsonJSONException *e) {
    [((OrgJsonJSONException *) nil_chk(e)) printStackTrace];
    return ComDzhyunSdkPb2Json_ERROR_JSON_;
  }
}

OrgJsonJSONArray *ComDzhyunSdkPb2Json_parseMsgWithComDzhyunProtoAutoMsg_MSG_(ComDzhyunProtoAutoMsg_MSG *msg) {
  ComDzhyunSdkPb2Json_initialize();
  id<JavaUtilSet> fields = [((id<JavaUtilMap>) nil_chk([((ComDzhyunProtoAutoMsg_MSG *) nil_chk(msg)) getAllFields])) entrySet];
  for (id<JavaUtilMap_Entry> __strong field in nil_chk(fields)) {
    ComGoogleProtobufDescriptors_FieldDescriptor *fd = [((id<JavaUtilMap_Entry>) nil_chk(field)) getKey];
    id val = [field getValue];
    if ([((ComGoogleProtobufDescriptors_FieldDescriptor *) nil_chk(fd)) getNumber] == [msg getId]) {
      OrgJsonJSONArray *array = [new_OrgJsonJSONArray_init() autorelease];
      id<JavaUtilList> msgs = (id<JavaUtilList>) check_protocol_cast([msg getFieldWithComGoogleProtobufDescriptors_FieldDescriptor:fd], JavaUtilList_class_());
      @try {
        for (jint i = 0; i < [((id<JavaUtilList>) nil_chk(msgs)) size]; i++) {
          [array putWithInt:i withId:ComDzhyunSdkPb2Json_parsePbMessageWithComGoogleProtobufMessage_([msgs getWithInt:i])];
        }
      }
      @catch (OrgJsonJSONException *e) {
        [((OrgJsonJSONException *) nil_chk(e)) printStackTrace];
        return [new_OrgJsonJSONArray_init() autorelease];
      }
      return array;
    }
  }
  return [new_OrgJsonJSONArray_init() autorelease];
}

OrgJsonJSONObject *ComDzhyunSdkPb2Json_parsePbMessageWithComGoogleProtobufMessage_(id<ComGoogleProtobufMessage> msg) {
  ComDzhyunSdkPb2Json_initialize();
  id<JavaUtilSet> fields = [((id<JavaUtilMap>) nil_chk([((id<ComGoogleProtobufMessage>) nil_chk(msg)) getAllFields])) entrySet];
  OrgJsonJSONObject *result = [new_OrgJsonJSONObject_init() autorelease];
  for (id<JavaUtilMap_Entry> __strong field in nil_chk(fields)) {
    ComGoogleProtobufDescriptors_FieldDescriptor *fd = [((id<JavaUtilMap_Entry>) nil_chk(field)) getKey];
    id val = [field getValue];
    ComGoogleProtobufDescriptors_FieldDescriptor_JavaTypeEnum *type = [((ComGoogleProtobufDescriptors_FieldDescriptor *) nil_chk(fd)) getJavaType];
    @try {
      if ([fd isRepeated]) {
        OrgJsonJSONArray *array = [new_OrgJsonJSONArray_init() autorelease];
        for (jint i = 0; i < [msg getRepeatedFieldCountWithComGoogleProtobufDescriptors_FieldDescriptor:fd]; i++) {
          id fval = [msg getRepeatedFieldWithComGoogleProtobufDescriptors_FieldDescriptor:fd withInt:i];
          if ([ComGoogleProtobufMessage_class_() isInstance:fval]) [array putWithInt:i withId:ComDzhyunSdkPb2Json_parsePbMessageWithComGoogleProtobufMessage_((id<ComGoogleProtobufMessage>) check_protocol_cast(fval, ComGoogleProtobufMessage_class_()))];
          else [array putWithInt:i withId:val];
        }
        [result putWithNSString:[fd getName] withId:array];
      }
      else if ([fd getJavaType] == JreLoadStatic(ComGoogleProtobufDescriptors_FieldDescriptor_JavaTypeEnum, MESSAGE)) {
        [result putWithNSString:[fd getName] withId:ComDzhyunSdkPb2Json_parsePbMessageWithComGoogleProtobufMessage_((id<ComGoogleProtobufMessage>) check_protocol_cast(val, ComGoogleProtobufMessage_class_()))];
      }
      else if ([fd getJavaType] == JreLoadStatic(ComGoogleProtobufDescriptors_FieldDescriptor_JavaTypeEnum, LONG)) {
        [result putWithNSString:[fd getName] withDouble:ComDzhyunSdkYFloat_parseWithLong_([((NSNumber *) nil_chk(((NSNumber *) check_class_cast(val, [NSNumber class])))) longLongValue])];
      }
      else [result putWithNSString:[fd getName] withId:val];
    }
    @catch (OrgJsonJSONException *e) {
      [((OrgJsonJSONException *) nil_chk(e)) printStackTrace];
      continue;
    }
  }
  return result;
}

OrgJsonJSONArray *ComDzhyunSdkPb2Json_parseTableWithComDzhyunProtoDzhpbtable_Table_(ComDzhyunProtoDzhpbtable_Table *table) {
  ComDzhyunSdkPb2Json_initialize();
  OrgJsonJSONArray *result = [new_OrgJsonJSONArray_init() autorelease];
  jint firstType = [((ComDzhyunProtoDzhpbtable_CInfo *) nil_chk([((ComDzhyunProtoDzhpbtable_Table *) nil_chk(table)) getInfoWithInt:0])) getType];
  jint rows;
  switch (firstType) {
    case ComDzhyunProtoDzhpbtable_InfoTypeEnum_Type_Table_VALUE:
    rows = [((ComDzhyunProtoDzhpbtable_CData *) nil_chk([table getDataWithInt:0])) getTValuesCount];
    break;
    case ComDzhyunProtoDzhpbtable_InfoTypeEnum_Type_SInt_VALUE:
    rows = [((ComDzhyunProtoDzhpbtable_CData *) nil_chk([table getDataWithInt:0])) getXValuesCount];
    break;
    case ComDzhyunProtoDzhpbtable_InfoTypeEnum_Type_Int_VALUE:
    rows = [((ComDzhyunProtoDzhpbtable_CData *) nil_chk([table getDataWithInt:0])) getIValuesCount];
    break;
    case ComDzhyunProtoDzhpbtable_InfoTypeEnum_Type_String_VALUE:
    rows = [((ComDzhyunProtoDzhpbtable_CData *) nil_chk([table getDataWithInt:0])) getSValuesCount];
    break;
    default:
    rows = 0;
  }
  IOSDoubleArray *sValues = [IOSDoubleArray arrayWithLength:[table getInfoCount]];
  IOSDoubleArray *rValues = [IOSDoubleArray arrayWithLength:[table getInfoCount]];
  @try {
    for (jint i = 0; i < rows; i++) {
      OrgJsonJSONObject *obj = [new_OrgJsonJSONObject_init() autorelease];
      for (jint j = 0; j < [table getInfoCount]; j++) {
        NSString *name = [((ComDzhyunProtoDzhpbtable_CInfo *) nil_chk([table getInfoWithInt:j])) getName];
        switch ([((ComDzhyunProtoDzhpbtable_CInfo *) nil_chk([table getInfoWithInt:j])) getType]) {
          case ComDzhyunProtoDzhpbtable_InfoTypeEnum_Type_Table_VALUE:
          [obj putWithNSString:name withId:ComDzhyunSdkPb2Json_parseTableWithComDzhyunProtoDzhpbtable_Table_([((ComDzhyunProtoDzhpbtable_CData *) nil_chk([table getDataWithInt:j])) getTValuesWithInt:i])];
          break;
          case ComDzhyunProtoDzhpbtable_InfoTypeEnum_Type_SInt_VALUE:
          if (i == 0) {
            ComDzhyunSdkYFloat *yf = ComDzhyunSdkYFloat_parseFromLongWithLong_([((ComDzhyunProtoDzhpbtable_CData *) nil_chk([table getDataWithInt:j])) getXValuesWithInt:i]);
            *IOSDoubleArray_GetRef(rValues, j) = ((ComDzhyunSdkYFloat *) nil_chk(yf))->ratio_;
            *IOSDoubleArray_GetRef(sValues, j) = (jdouble) JavaLangMath_roundWithDouble_(yf->val_ * yf->ratio_);
          }
          else {
            jint ratio = [((ComDzhyunProtoDzhpbtable_CInfo *) nil_chk([table getInfoWithInt:j])) hasRatio] ? [((ComDzhyunProtoDzhpbtable_CInfo *) nil_chk([table getInfoWithInt:j])) getRatio] : 1;
            JrePlusAssignDoubleD(IOSDoubleArray_GetRef(sValues, j), [((ComDzhyunProtoDzhpbtable_CData *) nil_chk([table getDataWithInt:j])) getXValuesWithInt:i] * ratio);
          }
          [obj putWithNSString:name withDouble:IOSDoubleArray_Get(sValues, j) / IOSDoubleArray_Get(rValues, j)];
          break;
          case ComDzhyunProtoDzhpbtable_InfoTypeEnum_Type_Int_VALUE:
          [obj putWithNSString:name withDouble:ComDzhyunSdkYFloat_parseWithLong_([((ComDzhyunProtoDzhpbtable_CData *) nil_chk([table getDataWithInt:j])) getIValuesWithInt:i])];
          break;
          case ComDzhyunProtoDzhpbtable_InfoTypeEnum_Type_String_VALUE:
          [obj putWithNSString:name withId:[((ComDzhyunProtoDzhpbtable_CData *) nil_chk([table getDataWithInt:j])) getSValuesWithInt:i]];
          break;
        }
      }
      [result putWithInt:i withId:obj];
    }
    return result;
  }
  @catch (OrgJsonJSONException *e) {
    [((OrgJsonJSONException *) nil_chk(e)) printStackTrace];
    return [new_OrgJsonJSONArray_init() autorelease];
  }
}

void ComDzhyunSdkPb2Json_init(ComDzhyunSdkPb2Json *self) {
  NSObject_init(self);
}

ComDzhyunSdkPb2Json *new_ComDzhyunSdkPb2Json_init() {
  ComDzhyunSdkPb2Json *self = [ComDzhyunSdkPb2Json alloc];
  ComDzhyunSdkPb2Json_init(self);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ComDzhyunSdkPb2Json)
